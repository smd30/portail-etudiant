<div class="content">
  <div class="container-fluid">

    <div class="row page-titles mx-0">
      <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
          <h4>Liste des enseignants</h4>
          <span class="ml-1">Gestion des enseignants</span>
        </div>
      </div>
      <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        <button class="btn btn-primary" (click)="openAddModal()">+ Ajouter un enseignant</button>
      </div>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

    <div class="card mt-3">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="thead-dark">
            <tr class="table-active">
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>Cours - Classes</th>
              <th class="text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngIf="isLoading">
              <td colspan="5" class="text-center">Chargement en cours...</td>
            </tr>
            <tr *ngFor="let enseignant of enseignants">
              <td>{{ enseignant.id }}</td>
              <td>{{ enseignant.user.nom }} {{ enseignant.user.prenom }}</td>
              <td>{{ enseignant.user.email }}</td>
              <td>
                <div *ngFor="let item of enseignant.coursClassrooms">
                  <span class="badge badge-info">{{ item.cours }}</span> →
                  <span class="badge badge-secondary">{{ item.classe }}</span>
                </div>
              </td>
              <td class="text-center">
                <button class="btn btn-sm btn-warning" (click)="openEditModal(enseignant)">Modifier</button>
                &nbsp;&nbsp;&nbsp;
                <button class="btn btn-sm btn-danger" (click)="confirmDelete(enseignant)">Supprimer</button>
              </td>
            </tr>
            <tr *ngIf="enseignants.length === 0 && !isLoading">
              <td colspan="5" class="text-center">Aucun enseignant trouvé.</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal Ajout/Modification -->
    <div class="modal" tabindex="-1" [class.show]="isModalOpen" [style.display]="isModalOpen ? 'block' : 'none'" aria-modal="true" role="dialog">
      <div class="modal-dialog">
        <form (ngSubmit)="submitForm()">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">{{ selectedEnseignant ? 'Modifier' : 'Ajouter' }} un enseignant</h5>
              <button type="button" class="close" (click)="isModalOpen = false">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group"><label>Nom</label><input type="text" [(ngModel)]="formData.user.nom" name="nom" required class="form-control"></div>
              <div class="form-group"><label>Prénom</label><input type="text" [(ngModel)]="formData.user.prenom" name="prenom" required class="form-control"></div>
              <div class="form-group"><label>Email</label><input type="email" [(ngModel)]="formData.user.email" name="email" required class="form-control"></div>
              <div class="form-group"><label>Téléphone</label><input type="text" [(ngModel)]="formData.user.telephone" name="telephone" class="form-control"></div>
              <div class="form-group"><label>Adresse</label><input type="text" [(ngModel)]="formData.user.addresse" name="addresse" class="form-control"></div>
              <div class="form-group"><label>Date de naissance</label><input type="date" [(ngModel)]="formData.user.date_naissance" name="date_naissance" class="form-control"></div>
              <div class="form-group"><label>Lieu de naissance</label><input type="text" [(ngModel)]="formData.user.lieu" name="lieu" class="form-control"></div>
              <div class="form-group">
                <label>Sexe</label>
                <select [(ngModel)]="formData.user.sexe" name="sexe" class="form-control" required>
                  <option value="M">Masculin</option>
                  <option value="F">Féminin</option>
                </select>
              </div>

              <!-- Ici tu peux ajouter la sélection multiple des cours et classes selon tes données -->
              <!-- Exemple simplifié, à adapter -->
              <!-- <div class="form-group">
                <label>Cours</label>
                <select multiple class="form-control" [(ngModel)]="formData.coursIds" name="coursIds">
                  <option *ngFor="let c of cours" [value]="c.id">{{ c.libelle }}</option>
                </select>
              </div> -->

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="isModalOpen = false">Annuler</button>
              <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal confirmation suppression -->
    <div class="modal" tabindex="-1" [class.show]="isDeleteModalOpen" [style.display]="isDeleteModalOpen ? 'block' : 'none'" aria-modal="true" role="dialog">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center">
            <p>Êtes-vous sûr de vouloir supprimer cet enseignant ?</p>
            <button class="btn btn-danger me-2" (click)="deleteEnseignant()">Oui</button>
            <button class="btn btn-secondary" (click)="cancelDelete()">Non</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
