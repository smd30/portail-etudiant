<div class="row page-titles mx-0">
  <div class="col-sm-6 p-md-0">
    <div class="welcome-text">
      <h4>Liste des élèves</h4>
      <span class="ml-1">Gestion des élèves</span>
    </div>
  </div>
  <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
    <button class="btn btn-primary" (click)="openAddModal()">+ Ajouter un élève</button>
  </div>
</div>

<div class="row mt-3">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="thead-dark">
            <tr class="table-active">
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>Classe</th>
              <th>Matricule</th>
              <th class="text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let eleve of eleves">
              <td>{{ eleve.id }}</td>
              <td>{{ eleve.user?.nom }} {{ eleve.user?.prenom }}</td>
              <td>{{ eleve.user?.email }}</td>
              <td>{{ eleve.classroom?.libelle }}</td>
              <td>{{ eleve.matricule }}</td>
              <td class="text-center">
                <div class="d-grid g-4 d-md-flex justify-content-md-end">
                  <button class="btn btn-sm btn-warning text-white"
                          (click)="openEditModal(eleve)">
                    Modifier
                  </button>
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  <button class="btn btn-sm btn-danger"
                          (click)="deleteEleve(eleve.id)">
                    Supprimer
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Bootstrap Ajouter / Modifier Élève -->
<div class="modal fade"
     id="modalAddEditEleve"
     tabindex="-1"
     role="dialog"
     aria-labelledby="modalLabel"
     aria-hidden="true"
     data-bs-backdrop="static"
     data-bs-keyboard="false">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form *ngIf="formEleve"
            [formGroup]="formEleve"
            (ngSubmit)="submit()"
            enctype="multipart/form-data">

        <div class="modal-header">
          <h5 class="modal-title" id="modalLabel">
            {{ isEditMode ? 'Modifier un élève' : 'Ajouter un élève' }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>

        <div class="modal-body">
          <!-- Champs identiques backend -->
          <div class="form-group">
            <label>Nom</label>
            <input type="text" formControlName="nom" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Prénom</label>
            <input type="text" formControlName="prenom" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Téléphone</label>
            <input type="text" formControlName="telephone" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <input type="text" formControlName="addresse" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Date de naissance</label>
            <input type="date" formControlName="date_naissance" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Lieu de naissance</label>
            <input type="text" formControlName="lieu" class="form-control" required />
          </div>
          <div class="form-group">
            <label>Sexe</label>
            <select formControlName="sexe" class="form-control" required>
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
            </select>
          </div>
          <div class="form-group">
            <label>Classe</label>
            <select formControlName="classroom_id" class="form-control" required>
              <option *ngFor="let c of classes" [value]="c.id">{{ c.libelle }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Justificatif (PDF/Image)</label>
            <input type="file" (change)="onFileChange($event)" class="form-control" />
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary" [disabled]="formEleve.invalid">
            {{ isEditMode ? 'Modifier' : 'Ajouter' }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
